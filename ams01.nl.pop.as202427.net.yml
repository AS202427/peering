peeringdb-api-key: ${ams01-nl-pop-peeringdb-api-key}
log-file: /var/log/bird.log
global-config: >
  define pop_region = 1;
  define pop_country = 528;
  define pop_id = 3;
  function reject_region_communitys() {
    if ((202427, 121, 1) ~ bgp_large_community) && ((202427, 121, pop_region) !~ bgp_large_community) then _reject("Announce only in Europe");
    if ((202427, 121, 2) ~ bgp_large_community) && ((202427, 121, pop_region) !~ bgp_large_community) then _reject("Announce only in North America");
    if ((202427, 111, pop_region) ~ bgp_large_community) then _reject("Do not announce in PoP Region");
  }
  function reject_country_communitys() {
    if ((202427, 122, 124) ~ bgp_large_community) && ((202427, 122, pop_country) !~ bgp_large_community) then _reject("Announce only in Canada");
    if ((202427, 122, 276) ~ bgp_large_community) && ((202427, 122, pop_country) !~ bgp_large_community) then _reject("Announce only in Germany");
    if ((202427, 122, 380) ~ bgp_large_community) && ((202427, 122, pop_country) !~ bgp_large_community) then _reject("Announce only in Italy");
    if ((202427, 122, 528) ~ bgp_large_community) && ((202427, 122, pop_country) !~ bgp_large_community) then _reject("Announce only in Netherlands");
    if ((202427, 122, 578) ~ bgp_large_community) && ((202427, 122, pop_country) !~ bgp_large_community) then _reject("Announce only in Norway");
    if ((202427, 122, 724) ~ bgp_large_community) && ((202427, 122, pop_country) !~ bgp_large_community) then _reject("Announce only in Spain");
    if ((202427, 122, 756) ~ bgp_large_community) && ((202427, 122, pop_country) !~ bgp_large_community) then _reject("Announce only in Switzerland");
    if ((202427, 122, 840) ~ bgp_large_community) && ((202427, 122, pop_country) !~ bgp_large_community) then _reject("Announce only in United States of America");
    if ((202427, 112, pop_country) ~ bgp_large_community) then _reject("Do not announce in PoP Country");
  }
  function reject_pop_communitys() {
    if ((202427, 123, 1) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at RMA01 CH");
    if ((202427, 123, 2) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at FRA01 DE");
    if ((202427, 123, 3) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at AMS01 NL");
    if ((202427, 123, 4) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at TOR01 CA");
    if ((202427, 123, 5) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at MKC01 US");
    if ((202427, 123, 6) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at BCN01 ES");
    if ((202427, 123, 7) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at OTT01 CA");
    if ((202427, 123, 8) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at FNC01 US");
    if ((202427, 123, 9) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at RESERVED EU");
    if ((202427, 123, 10) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at RESERVED EU");
    if ((202427, 123, 11) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at RESERVED EU");
    if ((202427, 123, 12) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at RESERVED EU");
    if ((202427, 123, 13) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at DUS01 DE");
    if ((202427, 123, 14) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at ZRH02 CH");
    if ((202427, 123, 15) ~ bgp_large_community) && ((202427, 123, pop_id) !~ bgp_large_community) then _reject("Announce only at POM01 IT");
    if ((202427, 113, pop_id) ~ bgp_large_community) then _reject("Do not announce at PoP");
  }
  function reject_communitys() {
    reject_region_communitys();
    reject_country_communitys();
    reject_pop_communitys();
  }
  function prepand_communitys () {
    if ((202427, 130, 1) ~ bgp_large_community) then { bgp_path.prepend(202427); }
    if ((202427, 130, 2) ~ bgp_large_community) then { bgp_path.prepend(202427); bgp_path.prepend(202427); }
    if ((202427, 130, 3) ~ bgp_large_community) then { bgp_path.prepend(202427); bgp_path.prepend(202427); bgp_path.prepend(202427); }
    if ((202427, 141, pop_region) ~ bgp_large_community) then { bgp_path.prepend(202427); }
    if ((202427, 142, pop_region) ~ bgp_large_community) then { bgp_path.prepend(202427); bgp_path.prepend(202427); }
    if ((202427, 143, pop_region) ~ bgp_large_community) then { bgp_path.prepend(202427); bgp_path.prepend(202427); bgp_path.prepend(202427); }
    if ((202427, 151, pop_country) ~ bgp_large_community) then { bgp_path.prepend(202427); }
    if ((202427, 152, pop_country) ~ bgp_large_community) then { bgp_path.prepend(202427); bgp_path.prepend(202427); }
    if ((202427, 153, pop_country) ~ bgp_large_community) then { bgp_path.prepend(202427); bgp_path.prepend(202427); bgp_path.prepend(202427); }
    if ((202427, 161, pop_id) ~ bgp_large_community) then { bgp_path.prepend(202427); }
    if ((202427, 162, pop_id) ~ bgp_large_community) then { bgp_path.prepend(202427); bgp_path.prepend(202427); }
    if ((202427, 163, pop_id) ~ bgp_large_community) then { bgp_path.prepend(202427); bgp_path.prepend(202427); bgp_path.prepend(202427); }
  }
  function reject_out_of_region() {
    if ! ((202427, 103, pop_region) ~ bgp_large_community) then _reject("Out of Region PoP");
  }
  function add_on_import() {
    bgp_large_community.add((202427, 102, pop_country));
    bgp_large_community.add((202427, 103, pop_region));
    bgp_large_community.add((202427, 104, pop_id));
  }
  function add_on_export() {
    bgp_large_community.add((202427, 109, pop_id));
  }
local-communities:
  - "202427:101:1"
  - "202427:107:3" # PoP
asn: 202427
prefixes: # Location Specific
# PoP
  - 2a06:a005:28e3::/48 # AS202427-ROUTING-NETWORK
# Anycasted
  - 2a06:a005:28e0::/48 # AS202427-ROUTING-NETWORK
  - 2a0a:6040:27e0::/43 # EU-AS202427-ANYCASTED
 #- 2a07:54c2:b00b::/48 # ::/b00b collective
 #- 2a0a:6044:b00b::/48 # ::/b00b collective
 #- 2a06:1283:b00b::/48 # ::/b00b collective
 #- 2a07:54c0:ffee::/48 # ::/c0ffe collective
  - 2a0f:b241:2c::/48 # Free48.net
# Location
  - 2a0a:6040:2740::/43 # NL-AS202427
# Virt Locations
router-id: 193.148.248.163 # PoP
irr-server: 128.241.192.40 # rr.ntt.net
source6: 2a06:a005:28e3::1 # PoP
default-route: false
blackhole-bogon-asns: true

peers:
# ========= Upstreams - PNI =========
  iFog:
    template: upstream
    description: iFog Upstream
    asn: 34927
    neighbors:
      - 2a0c:9a40:1072::1
    local-pref: 130
    listen6: 2a0c:9a40:1072::419
    as-set: RIPE::AS-IFOG

# ========= Upstreams - IXP =========
  Hurricane Electric Frys-IX:
    template: upstream
    description: Hurricane Electric LLC Upstream via Frys-IX
    asn: 6939
    neighbors:
      - 2001:7f8:10f::1b1b:154
    local-pref: 120
    listen6: 2001:7f8:10f::3:16bb:205
    add-on-import:
      - "202427:105:3512" # IX
    as-set: RADB::AS-HURRICANEV6

  Hyehost Frys-IX:
    template: upstream
    description: Hyehost LTD Upstream via Frys-IX
    asn: 47272
    neighbors:
      - 2001:7f8:10f::b8a8:28
    local-pref: 120
    listen6: 2001:7f8:10f::3:16bb:205
    add-on-import:
      - "202427:105:3512" # IX
    as-set: AS47272:AS-HYEHOST

# ========= Looking Glasses =========
  qrator:
    template: lg
    description: Radar by Qrator
    asn: 197068
    neighbors:
      - 178.248.237.29
    multihop: true
    listen4: 193.148.248.163
    password: qrator

  bgp.tools Frys-IX:
    template: lg
    description: BGP.Tools Route Collector via Frys-IX
    asn: 212232
    neighbors:
      - 2001:7f8:10f::3:3d08:247
    listen6: 2001:7f8:10f::3:16bb:205

  bgp.tools InterIX:
    template: lg
    description: BGP.Tools Route Collector via InterIX
    asn: 212232
    neighbors:
      - 2001:7f8:134::60
    listen6: 2001:7f8:134::43

# ========= Internal =========
  rma01-ch:
    template: downstream
    description: rma01.ch pop via WG
    asn: 215642
    neighbors:
      - 2a06:a005:2ef1::1
    listen6: 2a06:a005:2ef3::1
    as-set: AS215642

  fra01-de:
    template: core-l2
    description: fra01.de pop via L2
    asn: 202427
    neighbors:
      - 2a06:a005:2902::1
    listen6: 2a06:a005:2903::1

# ========= Route Servers =========
  Frys-IX Route Server:
    template: routeserver
    description: Frys-IX Route Server
    asn: 56393
    neighbors:
      - 2001:7f8:10f::dc49:253
      - 2001:7f8:10f::dc49:254
    local-pref: 220
    listen6: 2001:7f8:10f::3:16bb:205
    add-on-import:
      - "202427:105:3512" # IX
    as-set: AS-FRYS-IX-CONNECTED

  InterIX Route Server:
    template: routeserver
    description: InterIX Route Server
    asn: 56584
    neighbors:
      - 2001:7f8:134::253
      - 2001:7f8:134::254
      - 2001:7f8:134::251
    local-pref: 220
    listen6: 2001:7f8:134::43
    add-on-import:
      - "202427:105:3990" # IX
    as-set: AS56584:AS-INTERIX

# ========= Peers - Frys-IX =========
  Netwerkvereniging Coloclue Frys-IX:
    template: peer-frysix
    description: Netwerkvereniging Coloclue via Frys-IX
    asn: 8283
    neighbors:
      - 2001:7f8:10f::205b:140
      - 2001:7f8:10f::205b:187
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: AS8283:AS-COLOCLUE

  Cloudflare Frys-IX:
    template: peer-frysix
    description: Cloudflare via Frys-IX
    asn: 13335
    neighbors:
      - 2001:7f8:10f::3417:217
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: ARIN::AS13335:AS-CLOUDFLARE

  Google Frys-IX:
    template: peer-frysix
    description: Google via Frys-IX
    asn: 15169
    neighbors:
      - 2001:7f8:10f::3b41:180
      - 2001:7f8:10f::3b41:220
    listen6: 2001:7f8:10f::3:16bb:205
    password: ${edge01-ams-as15169-frysix-password}
    as-set: AS-GOOGLE

  IP-Max Frys-IX:
    template: peer-frysix
    description: IP-Max via Frys-IX
    asn: 25091
    neighbors:
      - 2001:7f8:10f::6203:135
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: RIPE::AS-IP-MAX-V6

  ISC F-ROOT AMS1 Frys-IX:
    template: peer-frysix
    description: ISC F-ROOT AMS1 via Frys-IX
    asn: 30132
    neighbors:
      - 2001:7f8:10f::75b4:147
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: RADB::AS30132:AS-SET

  Meta Frys-IX:
    template: peer-frysix
    description: Meta via Frys-IX
    asn: 32934
    neighbors:
      - 2001:7f8:10f::80a6:225
      - 2001:7f8:10f::80a6:226
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: AS-FACEBOOK

  Openfactory Frys-IX:
    template: peer-frysix
    description: Openfactory via Frys-IX
    asn: 58299
    neighbors:
      - 2001:7f8:10f::e3bb:137
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: AS58299:AS-ALL

  NetOne NL Frys-IX:
    template: peer-frysix
    description: NetOne NL via Frys-IX
    asn: 200132
    neighbors:
      - 2001:7f8:10f::3:dc4:239
      - 2001:7f8:10f::3:dc4:13
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: AS-NETONE-NL

  AS212635 Frys-IX:
    template: peer-frysix
    description: AS212635 via Frys-IX
    asn: 212635
    neighbors:
      - 2001:7f8:10f::3:3e9b:134
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: RIPE::AS212635:AS-212635

  LUJE.net Frys-IX:
    template: peer-frysix
    description: LUJE.net via Frys-IX
    asn: 212855
    neighbors:
      - 2001:7f8:10f::3:3f95:152
    listen6: 2001:7f8:10f::3:16bb:205
    as-set: RIPE::AS212855:AS-LUJE

# ========= Peers - InterIX =========
  Netwerkvereniging Coloclue InterIX:
    template: peer-interix
    description: Netwerkvereniging Coloclue via InterIX
    asn: 8283
    neighbors:
      - 2001:7f8:134::16
    listen6: 2001:7f8:134::43
    as-set: AS8283:AS-COLOCLUE

  Cloudflare InterIX:
    template: peer-interix
    description: Cloudflare via InterIX
    asn: 13335
    neighbors:
      - 2001:7f8:134::40
    listen6: 2001:7f8:134::43
    add-on-import:
    as-set: ARIN::AS13335:AS-CLOUDFLARE

  IP-Max InterIX:
    template: peer-interix
    description: IP-Max via InterIX
    asn: 25091
    neighbors:
      - 2001:7f8:134::22
    listen6: 2001:7f8:134::43
    as-set: RIPE::AS-IP-MAX-V6

  Openfactory InterIX:
    template: peer-interix
    description: Openfactory via InterIX
    asn: 58299
    neighbors:
      - 2001:7f8:134::13
    listen6: 2001:7f8:134::43
    as-set: AS58299:AS-ALL

  AS212635 InterIX:
    template: peer-interix
    description: AS212635 via InterIX
    asn: 212635
    neighbors:
      - 2001:7f8:134::25
    listen6: 2001:7f8:134::43
    as-set: RIPE::AS212635:AS-212635

# ===========================================================
templates:
  upstream:
    local-pref: 100
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     add_on_import();
     bgp_large_community.add((202427, 106, <pathvector.asn>));
     bgp_large_community.add((202427, 101, 2));
    pre-export: >
     reject_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then _reject("Do not announce to AS");
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:1"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    filter-max-prefix: false
    role: customer

  routeserver:
    local-pref: 200
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     add_on_import();
     bgp_large_community.add((202427, 106, <pathvector.asn>));
     bgp_large_community.add((202427, 101, 3));
    pre-export: >
     reject_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then _reject("Do not announce to AS");
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:1"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    enforce-first-as: false
    enforce-peer-nexthop: false
    filter-max-prefix: false
    filter-transit-asns: true
#    filter-never-via-route-servers: true

  peer:
    local-pref: 300
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     add_on_import();
     bgp_large_community.add((202427, 106, <pathvector.asn>));
     bgp_large_community.add((202427, 101, 4));
    pre-export: >
     reject_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then _reject("Do not announce to AS");
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:1"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    filter-irr: true
    strict-rpki: true
    filter-transit-asns: true
    auto-import-limits: true
    role: peer

  downstream:
    local-pref: 400
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     add_on_import();
     bgp_large_community.add((202427, 106, <pathvector.asn>));
     bgp_large_community.add((202427, 101, 5));
    pre-export: >
     reject_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then _reject("Do not announce to AS");
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:1"
      - "202427:101:2"
      - "202427:101:3"
      - "202427:101:4"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    filter-irr: true
    strict-rpki: true
    filter-transit-asns: true
    auto-import-limits: true
    role: provider

  lg:
    mp-unicast-46: true
    add-path-tx: true
    pre-export: >
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:1"
      - "202427:101:2"
      - "202427:101:3"
      - "202427:101:4"
      - "202427:101:5"
    receive-limit4: 0
    receive-limit6: 0

  core-tunnel:
    prepends: 1
    local-pref: 180
    next-hop-self: true
    rr-client: true
    allow-local-as: true
    add-path-tx: true
    add-path-rx: true
    pre-export: >
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:3"
      - "202427:101:4"
      - "202427:101:5"
    allow-blackhole-community: true

  core-l2:
    local-pref: 190
    next-hop-self: true
    rr-client: true
    allow-local-as: true
    add-path-tx: true
    add-path-rx: true
    pre-export: >
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:3"
      - "202427:101:4"
      - "202427:101:5"
    allow-blackhole-community: true

# ===========================================================

# IX: 3512
  peer-frysix:
    local-pref: 320
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     add_on_import();
     bgp_large_community.add((202427, 106, <pathvector.asn>));
     bgp_large_community.add((202427,101,4));
     bgp_large_community.add((202427,101,3512));
    pre-export: >
     reject_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then _reject("Do not announce to AS");
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:1"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    filter-irr: true
    strict-rpki: true
    filter-transit-asns: true
    auto-import-limits: true
    role: peer

# IX: 3990
  peer-interix:
    local-pref: 320
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     add_on_import();
     bgp_large_community.add((202427, 106, <pathvector.asn>));
     bgp_large_community.add((202427,101,4));
     bgp_large_community.add((202427,101,3990));
    pre-export: >
     reject_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then _reject("Do not announce to AS");
     prepand_communitys();
     add_on_export();
    announce:
      - "202427:101:1"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    filter-irr: true
    strict-rpki: true
    filter-transit-asns: true
    auto-import-limits: true
    role: peer
