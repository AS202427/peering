peeringdb-api-key: ${edge02-zhr-peeringdb-api-key}
log-file: /var/log/bird.log
global-config: >
 function reject_region_communitys() {
   if ((202427, 112, 1) ~ bgp_large_community) then reject; # Not in Europe
   if ((202427, 111, 2) ~ bgp_large_community) then reject; # Only in North America
 }
 function reject_country_communitys() {
   if ((202427, 114, 756) ~ bgp_large_community) then reject; # Not in Switzerland
   if ((202427, 113, 124) ~ bgp_large_community) then reject; # Only in Canada
   if ((202427, 113, 276) ~ bgp_large_community) then reject; # Only in Germany
   if ((202427, 113, 380) ~ bgp_large_community) then reject; # Only in Italy
   if ((202427, 113, 528) ~ bgp_large_community) then reject; # Only in Netherlands
   if ((202427, 113, 578) ~ bgp_large_community) then reject; # Only in Norway
   if ((202427, 113, 840) ~ bgp_large_community) then reject; # Only in United States of America
 }
 function reject_pop_communitys() {
   if ((202427, 116, 4) ~ bgp_large_community) then reject; # Not at ZHR02
   if ((202427, 115, 1) ~ bgp_large_community) then reject; # Only at NUE01
   if ((202427, 115, 2) ~ bgp_large_community) then reject; # Only at FRA01
   if ((202427, 115, 3) ~ bgp_large_community) then reject; # Only at ZHR01
   if ((202427, 115, 5) ~ bgp_large_community) then reject; # Only at MIL01
   if ((202427, 115, 6) ~ bgp_large_community) then reject; # Only at DUS01
   if ((202427, 115, 7) ~ bgp_large_community) then reject; # Only at AMS01
   if ((202427, 115, 8) ~ bgp_large_community) then reject; # Only at OSL01
   if ((202427, 115, 9) ~ bgp_large_community) then reject; # Only at YVR01
   if ((202427, 115, 10) ~ bgp_large_community) then reject; # Only at YTO01
   if ((202427, 115, 11) ~ bgp_large_community) then reject; # Only at FMT01
   if ((202427, 115, 12) ~ bgp_large_community) then reject; # Only at Reserved
   if ((202427, 115, 13) ~ bgp_large_community) then reject; # Only at Reserved
   if ((202427, 115, 14) ~ bgp_large_community) then reject; # Only at Reserved
   if ((202427, 115, 15) ~ bgp_large_community) then reject; # Only at Reserved
 }
 function reject_out_of_region() {
   if ((202427, 103, 2) ~ bgp_large_community) then reject; # North America
 }
local-communities:
  - "202427:101:1"
  - "202427:106:4" # Location Specific (PoP)
add-on-import:
  - "202427:102:756" # Location Specific (Country)
  - "202427:103:1" # Location Specific (Region)
  - "202427:104:4" # Location Specific (PoP)
add-on-export:
  - "202427:105:4" # Location Specific (PoP)
asn: 202427
prefixes: # Location Specific
  - 2a05:dfc1:620::/43  # AQ-AS202427
  - 2a05:dfc1:640::/43  # NZ-AS202427
  - 2a05:dfc1:5320::/43 # AT-AS202427
  - 2a05:dfc1:5340::/43 # FR-AS202427
  - 2a05:dfc1:5360::/43 # MX-AS202427
  - 2a05:dfc1:5380::/43 # JP-AS202427
  - 2a05:dfc1:53a0::/43 # ES-AS202427
  - 2a05:dfc1:53c0::/43 # LI-AS202427 
  - 2a05:dfc1:53e0::/43 # SE-AS202427
  - 2a06:a005:28e0::/48 # AS202427-BACKBONE-NETWORK
  - 2a06:a005:28e4::/48 # AS202427-BACKBONE-NETWORK
  - 2a0a:6040:2700::/43 # CH-AS202427
  - 2a0a:6040:27e0::/43 # EU-AS202427
  - 2a0e:97c0:5b0::/44  # EU-AS202427-Securebit
 #- 2a07:54c2:b00b::/48 # ::/b00b collective
router-id: 193.148.250.168 # Location Specific (PoP)
irr-server: 128.241.192.40 # rr.ntt.net
source6: 2a06:a005:28e4::1 # Location Specific (PoP)
default-route: false
blackhole-bogon-asns: true

peers:
  # ========= Upstreams =========
  iFog:
    template: upstream
    description: iFog GmbH Upstream
    asn: 34927
    neighbors:
      - 2a0c:9a40:1050::1
    local-pref: 120
    listen6: 2a0c:9a40:1050::418
    as-set: RIPE::AS-IFOG

  Hurricane Electric CHIX-CH:
    template: upstream
    description: Hurricane Electric LLC Upstream via CHIX-CH
    asn: 6939
    neighbors:
      - 2001:7f8:cc:333::137
    local-pref: 130
    listen6: 2001:7f8:cc:333::182
    add-on-import:
      - "202427:108:2365" # IX
    as-set: RADB::AS-HURRICANEV6

  Hurricane Electric SwissIX:
    template: upstream
    description: Hurricane Electric LLC Upstream via SwissIX
    asn: 6939
    neighbors:
      - 2001:7f8:24::aa
    local-pref: 130
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
    as-set: RADB::AS-HURRICANEV6

  # ========= Looking Glasses =========
  pmacctd:
    template: lg
    description: pmacctd
    asn: 202427
    listen6: 127.0.0.1
    neighbors:
      - 127.0.0.2
    neighbor-port: 180

  qrator:
    template: lg
    description: Radar by Qrator
    asn: 197068
    neighbors:
      - 178.248.237.29
    multihop: true
    listen4: 193.148.250.168
    password: qrator

  bgpTools:
    template: lg
    description: BGP.Tools Route Collector
    asn: 212232
    neighbors:
      - 185.230.223.55
    multihop: true
    listen4: 193.148.250.168

#  HE Realtime:
#    template: lg
#    description: Hurricane Electric Route Collector
#    disabled: false
#    asn: 393338
#    neighbors:
#      - 2001:470:0:441::20
#    multihop: true
#    listen6: 2a06:a005:28e4::1

  # ========= Internal =========
#  Core01 NUE:
#    template: core-wg
#    description: Core01 Router - Nuremberg, Germany
#    asn: 202427
#    neighbors:
#      - 2a06:a005:2ef1::1
#    listen6: 2a06:a005:2ef4::1

  Edge01 FRA:
    template: core-l2
    description: Edge01 Router - Frankfurt, Germany
    asn: 202427
    neighbors:
      - 2a06:a005:2902::1
    local-pref: 190
    listen6: 2a06:a005:2904::1

#  Edge01 MIL:
#    template: core-wg
#    description: Edge01 Router - Milan, Italy
#    asn: 202427
#    neighbors:
#      - 2a06:a005:2ef5::1
#    listen6: 2a06:a005:2ef4::1
#
#  Edge01 DUS:
#    template: core-wg
#    description: Edge01 Router - Dusseldorf, Germany
#    asn: 202427
#    neighbors:
#      - 2a06:a005:2ef6::1
#    listen6: 2a06:a005:2ef4::1

  Edge01 AMS:
    template: core-l2
    description: Edge01 Router - Amsterdam, Netherlands
    asn: 202427
    neighbors:
      - 2a06:a005:2907::1
    local-pref: 190
    listen6: 2a06:a005:2904::1

#  Edge01 OSL:
#    template: core-wg
#    description: Edge01 Router - Oslo, Norway
#    disabled: true
#    asn: 202427
#    neighbors:
#      - 2a06:a005:2ef8::1
#    listen6: 2a06:a005:2ef4::1

#  Edge01 YVR:
#    template: core-wg
#    description: Edge01 Router - Vancouver, Canada
#    asn: 202427
#    neighbors:
#      - 2a06:a005:2ef9::1
#    listen6: 2a06:a005:2ef4::1

#  Edge01 YTO:
#    template: core-wg
#    description: Edge01 Router - Toronto, Canada
#    asn: 202427
#    neighbors:
#      - 2a06:a005:2efa::1
#    listen6: 2a06:a005:2ef4::1
#
#  Edge01 FMT:
#    template: core-wg
#    description: Edge01 Router - Fremont, US
#    asn: 202427
#    neighbors:
#      - 2a06:a005:2efb::1
#    listen6: 2a06:a005:2ef4::1

  # ========= Route Servers =========
  CHIX-CH Route Server:
    template: routeserver
    description: CHIX-CH Route Server
    asn: 212100
    neighbors:
      - 2001:7f8:cc:333::254
      - 2001:7f8:cc:333::253
    local-pref: 220
    listen6: 2001:7f8:cc:333::182
    add-on-import:
      - "202427:108:2365" # IX
    as-set: AS-CHIX-RS

  BGP.Exchange Route Server:
    template: routeserver
    description: BGP.Exchange Zurich Route Server
    asn: 24381
    neighbors:
      -  2a0e:8f01:1000:25::1
    local-pref: 220
    listen6: 2a0e:8f01:1000:25::109
    add-on-import:
      - "202427:108:3830" # IX
    as-set: AS-BGPEXCHANGE

  SwissIX Route Server:
    template: routeserver
    description: SwissIX Route Server
    asn: 42476
    neighbors:
      - 2001:7f8:24::a5ec:a:1
      - 2001:7f8:24::a5ec:a:2
    local-pref: 220
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
    as-set: AS42476:AS-SWISSIX-CONNECTED

  # ========= Peers - CHIX-CH =========
  Google CHIX-CH:
    template: peer
    description: Google via CHIX-CH
    asn: 15169
    neighbors:
      - 2001:7f8:cc:333::169
    local-pref: 320
    listen6: 2001:7f8:cc:333::182
    password: ${edge02-zhr-as15169-chix-password}
    add-on-import:
      - "202427:108:2365" # IX
    as-set: RADB::AS-GOOGLE

  KTT Iceland CHIX-CH:
    template: peer
    description: KTT Iceland via CHIX-CH
    asn: 51019
    neighbors:
      - 2001:7f8:cc:333::190
    local-pref: 320
    listen6: 2001:7f8:cc:333::182
    add-on-import:
      - "202427:108:2365" # IX
    as-set: AS51019:AS-ALL

  Openfactory CHIX-CH:
    template: peer
    description: Openfactory via CHIX-CH
    asn: 58299
    neighbors:
      - 2001:7f8:cc:333::130
    local-pref: 320
    listen6: 2001:7f8:cc:333::182
    add-on-import:
      - "202427:108:2365" # IX
    as-set: AS58299:AS-ALL

#========================

  twopeaks digital e.U. CHIX-CH:
    template: peer
    passive: true
    description: twopeaks digital e.U. via CHIX-CH
    asn: 212828
    neighbors:
      - 2001:7f8:cc:333::189
    local-pref: 320
    listen6: 2001:7f8:cc:333::182
    add-on-import:
      - "202427:108:2365" # IX
    as-set: RIPE::AS-TWOPEAKS

#  SolNet CHIX-CH:
#    template: peer
#    passive: true
#    description: SolNet via CHIX-CH
#    asn: 9044
#    neighbors:
#      - 2001:7f8:cc:333::152
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS-SOLNET

#  Sandro Bolliger CHIX-CH:
#    template: peer
#    description: Sandro Bolliger via CHIX-CH
#    asn: 12307
#    neighbors:
#      - 2001:7f8:cc:333::155
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    password: ${edge02-zhr-as12307-chix-password}
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS-RAVANA

#  Init7 CHIX-CH:
#    template: peer
#    passive: true
#    description: Init7 via CHIX-CH
#    asn: 13030
#    neighbors:
#      - 2001:7f8:cc:333::177
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: RIPE::AS-INIT7

#  acdalis informatik CHIX-CH:
#    template: peer
#    passive: true
#    description: acdalis informatik via CHIX-CH
#    asn: 28859
#    neighbors:
#      - 2001:7f8:cc:333::144
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS28859

#  meerfarbig CHIX-CH:
#    template: peer
#    passive: true
#    description: meerfarbig via CHIX-CH
#    asn: 34549
#    neighbors:
#      - 2001:7f8:cc:333::146
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS-MEER

#  Sam Aschwanden CHIX-CH:
#    template: peer
#    passive: true
#    description: Sam Aschwanden via CHIX-CH
#    asn: 35202
#    neighbors:
#      - 2001:7f8:cc:333::143
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS-OTG

#  Stefan Dunkel CHIX-CH:
#    template: peer
#    passive: true
#    description: Stefan Dunkel via CHIX-CH
#    asn: 48646
#    neighbors:
#      - 2001:7f8:cc:333::140
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS-STEFANDUNKEL

#  DATAWIRE CHIX-CH:
#    template: peer
#    passive: true
#    description: DATAWIRE via CHIX-CH
#    asn: 48971
#    neighbors:
#      - 2001:7f8:cc:333::131
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS-DATAWIRE

#  Hats Network CHIX-CH:
#    template: peer
#    passive: true
#    description: Hats Network via CHIX-CH
#    asn: 203314
#    neighbors:
#      - 2001:7f8:cc:333::174
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS203314:AS-HATS

#  Raphael Peters CHIX-CH:
#    template: peer
#    passive: true
#    description: Raphael Peters via CHIX-CH
#    asn: 207968
#    neighbors:
#      - 2001:7f8:cc:333::157
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: RIPE::AS-RAPPET

#  Andreas Fries CHIX-CH:
#    template: peer
#    passive: true
#    description: Andreas Fries via CHIX-CH
#    asn: 213126
#    neighbors:
#      - 2001:7f8:cc:333::148
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS213126

#  level66.network CHIX-CH:
#    template: peer
#    passive: true
#    description: level66.network via CHIX-CH
#    asn: 56381
#    neighbors:
#      - 2001:7f8:cc:333::167
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS56381:AS-ALL

#  efero CHIX-CH:
#    template: peer
#    passive: true
#    description: efero via CHIX-CH
#    asn: 208431
#    neighbors:
#      - 2001:7f8:cc:333::184
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS-EFERO

#  Asympto Networks CHIX-CH:
#    template: peer
#    passive: true
#    description: Asympto Networks via CHIX-CH
#    asn: 39533
#    neighbors:
#      - 2001:7f8:cc:333::149
#    local-pref: 320
#    listen6: 2001:7f8:cc:333::182
#    add-on-import:
#      - "202427:108:2365" # IX
#    as-set: AS39533:AS-ALL

  # ========= Peers - SwissIX =========
  Netwerkvereniging Coloclue SwissIX:
    template: peer
    description: Netwerkvereniging Coloclue via SwissIX
    asn: 8283
    neighbors:
      - 2001:7f8:24::118
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
    as-set: AS8283:AS-COLOCLUE

  Cloudflare SwissIX:
    template: peer
    description: Cloudflare via SwissIX
    asn: 13335
    neighbors:
      - 2001:7f8:24::c0
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
    as-set: ARIN::AS13335:AS-CLOUDFLARE

  Google SwissIX:
    template: peer
    description: Google via SwissIX
    asn: 15169
    neighbors:
      - 2001:7f8:24::4a
      - 2001:7f8:24::df
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    password: ${edge02-zhr-as15169-swissix-password}
    add-on-import:
      - "202427:108:60" # IX
    as-set: RADB::AS-GOOGLE

  BIT/FOITT SwissIX:
    template: peer
    description: BIT/FOITT via SwissIX
    asn: 33845
    neighbors:
      - 2001:7f8:24::2e
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    password: ${edge02-zhr-as33845-swissix-password}
    add-on-import:
      - "202427:108:60" # IX
    as-set: RIPE::AS-SWISSGOV

  OVHcloud SwissIX:
    template: peer
    description: OVHcloud via SwissIX
    asn: 16276
    neighbors:
      - 2001:7f8:24::3f94:0:1
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
    as-set: AS-OVH

#========================
  Nine Internet Solutions AG SwissIX:
    template: peer
    passive: true
    description: Nine Internet Solutions AG via SwissIX
    asn: 29691
    neighbors:
      - 2001:7f8:24::9
      - 2001:7f8:24::d5
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
    as-set: AS-NINE

  Netcetera AG SwissIX:
    template: peer
    passive: true
    description: Netcetera AG via SwissIX
    asn: 34960
    neighbors:
      - 2001:7f8:24::59
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
    as-set: AS34960

  Netrics Zuerich AG SwissIX:
    template: peer
    passive: true
    description: Netrics Zuerich AG via SwissIX
    asn: 31424
    neighbors:
      - 2001:7f8:24::11
      - 2001:7f8:24::31
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
    as-set: AS-NEXELLENT

  Akamai Technologies SwissIX:
    template: peer
    passive: true
    description: Akamai Technologies via SwissIX
    asn: 20940
    neighbors:
      - 2001:7f8:24::38
    local-pref: 320
    listen6: 2001:7f8:24:0:3:16bb:0:1
    add-on-import:
      - "202427:108:60" # IX
      - "202427:111:1" # Announce in Europe only
    as-set: AS-AKAMAI
    pre-export-final: >
     reject_out_of_region();

templates:
  upstream:
    local-pref: 100
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     bgp_large_community.add((202427, 101, 2));
     bgp_large_community.add((202427, 107, <pathvector.asn>));
    pre-export: >
     reject_region_communitys();
     reject_country_communitys();
     reject_pop_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then reject;
    announce:
      - "202427:101:1"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    filter-max-prefix: false
    role: customer

  routeserver:
    local-pref: 200
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     bgp_large_community.add((202427, 101, 3));
     bgp_large_community.add((202427, 107, <pathvector.asn>));
    pre-export: >
     reject_region_communitys();
     reject_country_communitys();
     reject_pop_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then reject;
    announce:
      - "202427:101:1"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    enforce-first-as: false
    enforce-peer-nexthop: false
    filter-max-prefix: false
    filter-transit-asns: true
#    filter-never-via-route-servers: true

  peer:
    local-pref: 300
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     bgp_large_community.add((202427, 101, 4));
     bgp_large_community.add((202427, 107, <pathvector.asn>));
    pre-export: >
     reject_region_communitys();
     reject_country_communitys();
     reject_pop_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then reject;
    announce:
      - "202427:101:1"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    filter-irr: true
    strict-rpki: true
    filter-transit-asns: true
    auto-import-limits: true
    role: peer

  downstream:
    local-pref: 400
    add-path-tx: true
    add-path-rx: true
    pre-import-accept: >
     bgp_large_community.add((202427, 101, 5));
     bgp_large_community.add((202427, 107, <pathvector.asn>));
    pre-export: >
     reject_region_communitys();
     reject_country_communitys();
     reject_pop_communitys();
     if ((202427, 110, <pathvector.asn>) ~ bgp_large_community) then reject;
    announce:
      - "202427:101:1"
      - "202427:101:2"
      - "202427:101:3"
      - "202427:101:4"
      - "202427:101:5"
    remove-all-communities: 202427
    allow-blackhole-community: true
    filter-irr: true
    strict-rpki: true
    filter-transit-asns: true
    auto-import-limits: true
    role: provider

  lg:
    mp-unicast-46: true
    add-path-tx: true
    announce:
      - "202427:101:1"
      - "202427:101:2"
      - "202427:101:3"
      - "202427:101:4"
      - "202427:101:5"
    receive-limit4: 0
    receive-limit6: 0

  core-wg:
    prepends: 1
    local-pref: 180
    next-hop-self: true
    allow-local-as: true
    add-path-tx: true
    add-path-rx: true
    announce:
      - "202427:101:3"
      - "202427:101:4"
      - "202427:101:5"
    remove-communities:
      - "202427:105:1"
      - "202427:105:2"
      - "202427:105:3"
      - "202427:105:4"
      - "202427:105:5"
      - "202427:105:6"
      - "202427:105:7"
      - "202427:105:8"
      - "202427:105:9"
      - "202427:105:10"
      - "202427:105:11"
      - "202427:105:12"
      - "202427:105:13"
      - "202427:105:14"
      - "202427:105:15"
    allow-blackhole-community: true

  core-l2:
    local-pref: 190
    next-hop-self: true
    allow-local-as: true
    add-path-tx: true
    add-path-rx: true
    announce:
      - "202427:101:3"
      - "202427:101:4"
      - "202427:101:5"
    remove-communities:
      - "202427:105:1"
      - "202427:105:2"
      - "202427:105:3"
      - "202427:105:4"
      - "202427:105:5"
      - "202427:105:6"
      - "202427:105:7"
      - "202427:105:8"
      - "202427:105:9"
      - "202427:105:10"
      - "202427:105:11"
      - "202427:105:12"
      - "202427:105:13"
      - "202427:105:14"
      - "202427:105:15"
    enforce-first-as: false
    allow-blackhole-community: true
    filter-rpki: false
